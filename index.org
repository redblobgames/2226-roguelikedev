#+title: Roguelike Dev
#+date: <2022-06-28 Tue>
#+options: toc:nil

Each summer r/roguelikedev has a [[https://old.reddit.com/r/roguelikedev/wiki/python_tutorial_series][summer event]] in which we all make a simple roguelike, roughly following the libtcod roguelike tutorial. I've tried several times and [[href:/x/2025-roguelike-dev/][actually finished in 2020]], using [[https://ondras.github.io/rot.js/hp/][rot.js]] and Javascript. I kept the scope down by implementing only the topics from the tutorial. Then [[href:/x/2126-roguelike-dev/][in 2021]] I implemented topics I wanted to try: thin walls, graphics, animations, openable doors, new map generator. I had many more things I wanted to try but I was too ambitious.

For this year's summer event I'd like to do something more "fortress mode" and less "adventure mode". 

#+include: "game.html" export html

(Icons from [[https://game-icons.net][game-icons.net]], CC BY 3.0)

#+TOC: headlines 2

1. map generation will be a wilderness map, not a dungeon map
1. you'll dig and build on the map to make your own settlement
1. no field of view; you can see everything
1. scrolling map
1. there will be friendly npcs

* Setting up
:PROPERTIES:
:UNNUMBERED: t
:SECTION_NUMBER: 0
:CUSTOM_ID: setting-up
:END:

Compared to a Python project, I feel the set up is simpler in Javascript. I started with =game.html=:

#+begin_src html
<canvas id="game" width="660" height="660" />
<script src="build/_bundle.js"></script>
#+end_src

If I were using rot.js, there's be one more =<script>= line. This year I'm not using rot.js. I'm using Typescript instead of Javascript. Here's =roguelike-dev.ts=:

#+begin_src typescript
const canvas = document.querySelector("#game") as HTMLCanvasElement;
#+end_src

The Typescript file has to be compiled into Javascript before the browser will run it. I've been using [[https://esbuild.github.io/][esbuild]] for that. I really like it. I have lots of small projects and have standardized on having a file called ~./build.sh~ that will build the project:

#+begin_src sh
#!/bin/sh
mkdir -p build/
esbuild roguelike-dev.ts --bundle --outfile=build/_bundle.js
#+end_src

There's a [[https://devblogs.microsoft.com/typescript/a-proposal-for-type-syntax-in-javascript/][proposal to allow but ignore types in Javascript's syntax]], similar to what Python does. If that passes, then I won't need this build step. But it only takes 0.06 seconds to run and I run it automatically on file save so it's only a minor annoyance right now.

For the rest of this project I'm going to /try/ to follow the same section numbers as the original Python tutorial and the r/roguelikedev summer event, but some topics won't make sense in fortress mode so I will do something else instead.

* TODO Moving around
:PROPERTIES:
:CUSTOM_ID: moving-around
:END:

** Rendering
:PROPERTIES:
:CUSTOM_ID: rendering
:END:

I'm using <canvas> this year, not <svg>. Conveniently, game-icons icons are all a /single <path>/, and paths can be drawn to a <canvas> using https://developer.mozilla.org/en-US/docs/Web/API/Path2D. To load the icon into memory, I can use esbuild's loaders to make importing an svg work:

#+begin_src js
import person from "./game-icons/delapouite/person.svg";
#+end_src

#+begin_src sh
esbuild --loader:.svg=text
#+end_src

This will make =person= the contents of the svg file.

But I need to build a mapping from icon + style (color / gradient / outline) to tile type, or I could switch to webgl so that I could do these things in shaders. Probably not worth webgl yet. Keep it simple. One color + shape per object.

** Keyboard

For the keyboard I'm mostly following what I did two years ago: [[href:/x/2025-roguelike-dev/#key-input]]


* TODO Entity, render, map
:PROPERTIES:
:CUSTOM_ID: entity-render-map
:END:

* TODO Generating a map
:PROPERTIES:
:CUSTOM_ID: generating-a-map
:END:

* TODO Field of view
:PROPERTIES:
:CUSTOM_ID: field-of-view
:END:

* TODO Placing enemies
:PROPERTIES:
:CUSTOM_ID: placing-enemies
:END:

* TODO Combat
:PROPERTIES:
:CUSTOM_ID: combat
:END:

* TODO Interface
:PROPERTIES:
:CUSTOM_ID: interface
:END:

* TODO Items and inventory
:PROPERTIES:
:CUSTOM_ID: items-and-inventory
:END:

* TODO Ranged scrolls and targeting
:PROPERTIES:
:CUSTOM_ID: ranged-scrolls-and-targeting
:END:

* TODO Saving and loading
:PROPERTIES:
:CUSTOM_ID: saving-and-loading
:END:

* TODO Dungeon levels
:PROPERTIES:
:CUSTOM_ID: dungeon-levels
:END:

* TODO Increasing difficulty
:PROPERTIES:
:CUSTOM_ID: increasing-difficulty
:END:

* TODO Gearing up
:PROPERTIES:
:CUSTOM_ID: gearing-up
:END:

#+begin_export html
<x:footer>
  Created 28 Jun 2022; &#160;
  <!-- hhmts start -->Last modified: 01 Jul 2022<!-- hhmts end -->
</x:footer>
#+end_export
